{% extends 'cp_nigeria/steps/step_progression.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load custom_filters %}
{% load i18n %}

{% block head_block %}
<style>
.highlight {
  background-color: blue;
}
</style>
{% endblock head_block %}

<!-- WRITE HTML CODE WITHIN THESE block content TAGS -->
{% block progression_content %}

{% include "modal_template.html" with id="helpSelectBMModal" modal_style_class="modal--gui" submit_btn_label="Save" title="Assess suitability for a community-led approach" custom_submit_function="suggestBusinessModel(event)"%}


<form action="{% url 'cpn_model_choice' proj_id %}" method="POST">
		{{ form }}
	 {% csrf_token %}
	<!--button type="submit"> next</button-->
	</form>

<div id="selected_model">

</div>

{% if recommanded_model %}
<p>
	Recommanded model: {{ recommanded_model }}
	<span>Text explaning why this model was choosen</span>
</p>
{% endif %}
{% endblock progression_content %}


{% block end_body_scripts %}
<script src="{% static 'js/modal_utils.js' %}"></script>


<script>
	var helpSelectBMModalDOM = document.getElementById("helpSelectBMModal");
	$(document).on('change', '#id_model_name', function () {
		document.getElementById("selected_model").innerHTML = ""
		console.log('selection changed')
		console.log($(this).val());
		var modelChoice = $(this).val();  // get the selected model from the HTML input

		if(modelChoice == ""){}
		else if(modelChoice == "help_select")
		{
			console.log("help select");

			$.ajax({
				url: `{% url 'help_select_questions' bm.id %}`,
				success: function (formContent) {
					console.log(formContent);
					helpSelectBMModalDOM.querySelector('form').innerHTML = formContent;
					showModal(event,modalId='helpSelectBMModal', attrs={'action': `{% url 'help_select_questions' bm.id %}`, 'enctype': 'multipart/form-data' })
				}
			});
		}
		else {
			$.ajax({
				url: `{% url 'ajax_bmodel_infos' %}`,
				data: {
					'model_choice': modelChoice
				},
				success: function (data) {
					console.log(data);
					document.getElementById("selected_model").innerHTML = data
				}
			});
		}
	});

	function suggestBusinessModel(event){
		hideModal(modalId='helpSelectBMModal');
		helpSelectBMModalDOM.querySelector('form').submit()
	}
</script>

{% if recommanded_model %}
<script>
	$("#id_model_name").change();
</script>
{% endif %}

{% endblock end_body_scripts %}
